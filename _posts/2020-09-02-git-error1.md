---
layout: post
title:  "[error]the requested upstream branch 'origin/feature-rsv' does not exist"
date:   2020-09-02 12:36:00 +0900
categories: git
---

새로운 브랜치를 만들고, remote에 넣어준 다음 tracked 시키려고 했는데 자꾸 아래와 같은 에러 메시지가 발생했다.

## Error Message
```bash
error: the requested upstream branch 'origin/feature-rsv' does not exist
hint: 
hint: If you are planning on basing your work on an upstream
hint: branch that already exists at the remote, you may need to
hint: run "git fetch" to retrieve it.
hint: 
hint: If you are planning to push out a new local branch that
hint: will track its remote counterpart, you may want to use
hint: "git push -u" to set the upstream config as you push.
```

## Error 전 진행 과정
```bash
$ git remote -v
origin	https://github.com/hyex/w1.git (fetch)
origin	https://github.com/hyex/w1.git (push)
upstream	https://github.com/boostcamp-2020/w1.git (fetch)
upstream	https://github.com/boostcamp-2020/w1.git (push)

$ git branch
* J062

$ git checkout -b feature-rsv
Switched to a new branch 'feature-rsv'

$ git branch
  J062
* feature-rsv

$ git branch -vv
  J062        2a563f9 [origin/J062: ahead 16] merge
* feature-rsv 2a563f9 merge

$ git push -u origin feature-rsv
Total 0 (delta 0), reused 0 (delta 0)
remote: 
remote: Create a pull request for 'feature-rsv' on GitHub by visiting:
remote:      https://github.com/hyex/w1/pull/new/feature-rsv
remote: 
To https://github.com/hyex/w1.git
 * [new branch]      feature-rsv -> feature-rsv
Branch 'feature-rsv' set up to track remote branch 'feature-rsv' from 'origin'.

$ git branch -vv
  J062        2a563f9 [origin/J062: ahead 16] merge
* feature-rsv 2a563f9 merge # problem

```

원래는 # problem 부분에서 traked가 되었다면 `[origin/feature-rsv:] ...` 이런 식으로 떠야 한다.
`git push -u` 명령어를 통해 traked가 될 것이라고 생각했는데 실패해서 아래 명령어를 사용하고, 위 에러 메시지를 만났다.

```bash
$ git branch --set-upstream-to origin/feature-rsv
error: the requested upstream branch 'origin/feature-rsv' does not exist
hint: 
hint: If you are planning on basing your work on an upstream
hint: branch that already exists at the remote, you may need to
hint: run "git fetch" to retrieve it.
hint: 
hint: If you are planning to push out a new local branch tha
```

## 해결 과정
이 것 저 것 해봐도 다 안되어서 열받던 찰나에, `.git/config`를 고쳐야 한다는 [글](https://stackoverflow.com/questions/17210624/cant-track-remote-branch-doesnt-recognize-origin-develop)를 보게되었다.

`.git/config`
```bash
	[core]
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true
        ignorecase = true
        precomposeunicode = true
	[remote "origin"]
	        url = https://github.com/hyex/w1.git
	        fetch = +refs/heads/J062:refs/remotes/origin/J062 # here
	[branch "J062"]
	        remote = origin
	        merge = refs/heads/J062
	[remote "upstream"]
	        url = https://github.com/boostcamp-2020/w1.git
	        fetch = +refs/heads/J062:refs/remotes/upstream/J062
	[branch "feature-rsv"]
	        remote = origin
	        merge = refs/heads/feature-rsv                     
```

여기서 감이 왔다. # here 부분에서 fetch에 브랜치 이름이 들어가있고, 뭔가 에러 메시지에서 fetch를 해보라는데 안되는 걸로 봐서는 저게 문제인 것 같았다. 다음과 같이 수정했다.

```bash
fetch = +refs/heads/*:refs/remotes/origin/*
```

그리고 확인해봤다.

```bash
$ git branch -vv
  J062        2a563f9 [origin/J062: ahead 16] merge
* feature-rsv 780d9bd [origin/feature-rsv: gone] Refactor: DB structure
```

## 이유
clone할 때 single-bransh 옵션을 주었더니 자동으로 fetch에 저 값이 들어갔던 것 같다. 한참을 삽질했지만 찾아서 다행


## 이건 그냥 보다가 좋았던 링크
https://devconnected.com/how-to-set-upstream-branch-on-git/#Set_upstream_branch_for_an_existing_remote_branch
